{% extends 'base.html.twig' %}

{% block title %}  Modifier un devis {% endblock %}

{% block stylesheets %}
{% endblock %}
       {% block smenu %}
           <ul class="breadcrumb">
               <li class="breadcrumb-item">
                   <a href="{{ path('dashboard_personelle') }}">Tableau de bord</a>
               </li>
               <li class="breadcrumb-item">
                   <a href="{{ path('perso_index_devis') }}">devis</a>
               </li>
               <li class="breadcrumb-item">
                   <span>Modifier </span>
               </li>
           </ul>
       {% endblock %}

        {% block content %}
            {{ include('commercial/devis/include/_modal_confirm_transfertDevis.html.twig') }}

            <div class="content-box">
                <div class="row">
                    <div class="col-sm-12 col-xxxl-12">
                        <div class="element-wrapper">
                            <h6 class="element-header">
                                Modifier un devis
                            </h6>
                            <div class="element-box" style="min-height: 360px">
                                <form method="post" action="{{ path('perso_edit_devis', {id: devi['id']}) }}" class="formEditDevis">
                                    <input type="hidden" class="fodecChecked" name="fodecChecked" value="">

                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label for="validationCustom01">Client</label>
                                            <select name="customers"
                                                    class="form-control customers js-example-basic-single">
                                                <option value="0" selected disabled>Choisir un client</option>
                                                {% for c in customers %}
                                                    <option value="{{ c.id }}" {%  if devi['client']['id'] == c.id %} selected {% endif %}>{{devi['client']['nom']}} {{devi['client']['prenom'] }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="validationCustom01">Date de création</label>
                                            <input type="text" class="form-control date_creation"
                                                   id="validationCustom01" required=""
                                                   value="{{ devi['creadetAt']|date('d/m/Y') }}" disabled
                                                   name="date_creation">
                                        </div>

                                        <div class="col-md-4 mb-3">
                                            <label for="validationCustom01">Total TTC</label>
                                            <input type="text" class="form-control tottalTTC"
                                                   value=" {%  if devi['statusMaj']  %} 0.000 {% else  %}{{ devi['totalTTC']|number_format(3) }}{% endif %}"
                                                   style="font-size: 25px; color: red; font-weight: bold"
                                                   id="validationCustom01" required="" disabled
                                                   name="tottalTTC">
                                        </div>
                                    </div>

                                    <div class="table-responsive">
                                        <table class="table table-lightborder">
                                            <thead>
                                            <tr id="ligne_article_1">
                                                <th scope="col">#</th>
                                                <th scope="col">Réference</th>
                                                <th scope="col">Désignation</th>
                                                <th scope="col">Stock</th>
                                                <th scope="col">Qte</th>
                                                <th scope="col">Remise %</th>
                                                <th scope="col">P.Vente TTC</th>
                                                <th scope="col">Total</th>
                                            </tr>
                                            </thead>
                                            <tbody class="tbodyLingeArticle">
                                            <input type="text" hidden value="" name="articleToDelete[]"
                                                   class="articleToDelete">
                                            {%  for art in devi['devisArticles'] %}
                                                <tr class="ligne_article">
                                                    <th scope="row">
                                                        <button class="btn btn-danger mr-2 delete_ligneArticle  delete_ligneArticle_{{loop.index}}"
                                                                data-toggle="tooltip" type="button"
                                                                data-id_article= "{{ art['article']['id']}}"
                                                                data-index="{{ loop.index }}"

                                                                data-placement="top" title="" data-original-title="Supprimer"><i
                                                                    class="fa fa-trash"></i></button>
                                                    </th>
                                                    <td>
                                                        <input type="hidden" class="articleAnnuler{{loop.index }}" value="{{ art['article']['id']  }}">
                                                        <select class="js-example-basic-single selectArticle   selectArticle_{{loop.index}} "
                                                                data-id_index = "{{loop.index}}"  name="article[]">
                                                            <option value="0" selected readonly>Coisir un article</option>
                                                            {% for a in articles %}
                                                                <option value="{{ a.id }}" {% if  art['article']['id'] == a.id %} selected {% endif %}>{{ a.ref }}</option>
                                                            {% endfor %}
                                                        </select>

                                                    </td>
                                                    <td class="descriptionarticle_{{loop.index}}">{{ art['article']['description'] }}</td>
                                                    <td>
                                                        <input type="text" name="stock" data-index = "{{loop.index}}" value="{{ art['article']['prixes'][0]['qte'] }}" class="form-control  stock stock_{{loop.index}} stockArt_{{ art['article']['id']}}" readonly >
                                                    </td>
                                                    <td>
                                                        <input type="hidden"  class="oldQteArt_{{ loop.index }}" value=" {%  if devi['statusMaj']  %} 0 {% else %}{{ art['qte'] }} {% endif %}">

                                                        <input type="text" min="1" name="qte[]" pattern="[0-9]"  data-index ="{{loop.index}}" value="{%  if devi['statusMaj']  %} 0 {% else %}{{ art['qte'] }} {% endif %}" class="form-control qte qte_{{loop.index}} qteArt_{{ art['article']['id']}}" data-id_art="{{ art['article']['id']}}" >

                                                    </td>
                                                    <td>
                                                        <input type="text" value="{{ art['article']['remise'] }}" name="remise" data-index = "{{loop.index}}"  class="form-control remise remise_{{loop.index}} remise_{{ art['article']['id']}}" readonly>

                                                    </td>
                                                    <td>
                                                        <input type="text" name="pventettc[]" value="{{  art['article']['prixes'][0]['puVenteTTC']|number_format(3) }}" data-index = "{{loop.index}}" class="form-control pventettc pventettc_{{loop.index}} pventettcArt_{{ art['article']['id']}}" readonly>

                                                    </td>
                                                    <td>
                                                        <input type="text" name="total[]" value=" {%  if devi['statusMaj']  %} 0.000 {% else %}{{ art['total']|number_format(3) }} {% endif %}" data-index = "{{loop.index}}" class="form-control total total_{{loop.index}} totalArt_{{ art['article']['id']}}" readonly>

                                                    </td>
                                                </tr>


                                            {% endfor %}

                                            </tbody>


                                        </table>

                                    </div>
                                    <button type="button" class="mt-2 btn btn-primary float-right addLingneArticle"><i
                                                class="fa fa-plus"></i>Autre
                                    </button>
                                    <button type="button" class="mt-5 btn btn-primary editDevis w-100"
                                    ><i
                                                class="fa fa-save"></i> Modifier
                                    </button>
                                    {% if devi['statusMaj'] == 1 %}

                                    <button type="button" class="mt-5 btn btn-primary transfertDevis w-100"  data-id_devis= {{ devi['id'] }}
                                    ><i
                                                class="fa fa-share"></i> Transfert vers BL
                                    </button>

                                    {% endif %}
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        {% endblock %}

{% block javascripts %}
    <script>   $(document).ready(function () {
            $('.js-example-basic-single').select2();
        });

    </script>
    <script src="{{ asset('app/js/comercial/devis/edit.js') }}"></script>
{% endblock %}